import{r as i}from"./vendor-DneCX9Yi.js";import{lumi as r}from"./lumi-ycYV9txU.js";function w(){const[l,p]=i.useState(r.auth.user),[a,c]=i.useState(r.auth.isAuthenticated),[d,o]=i.useState(!1);return i.useEffect(()=>r.auth.onAuthChange(({isAuthenticated:u,user:e})=>{p(e),c(u)}),[]),{user:l,isAuthenticated:a,loading:d,signIn:async()=>{o(!0);try{const{user:s,accessToken:u}=await r.auth.signIn();return console.log("User authenticated:",s),{user:s,accessToken:u}}catch(s){throw console.error("Authentication failed:",s),s}finally{o(!1)}},signOut:()=>{r.auth.signOut()}}}function y(){const[l,p]=i.useState([]),[a,c]=i.useState(null),[d,o]=i.useState(!1),h=async e=>{o(!0);try{const{list:t}=await r.entities.subscriptions.list({filter:{userId:e},sort:{createdAt:-1},limit:5}),n=t.find(b=>b.status==="active"||b.status==="trialing");return c(n||null),n||null}catch(t){return console.error("Failed to fetch subscription:",t),null}finally{o(!1)}},S=async e=>{try{return await r.entities.subscriptions.create({...e,status:"pending",accessPassword:"TitanGryx2024",creator:e.userId,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}catch(t){throw console.error("Failed to create subscription:",t),t}},s=async(e,t)=>{try{const n=await r.entities.subscriptions.update(e,{...t,updatedAt:new Date().toISOString()});return(a==null?void 0:a._id)===e&&c(n),n}catch(n){throw console.error("Failed to update subscription:",n),n}};return{subscriptions:l,currentSubscription:a,loading:d,fetchUserSubscription:h,createSubscription:S,updateSubscription:s,cancelSubscription:async e=>{try{await s(e,{status:"cancelled",autoRenew:!1})}catch(t){throw console.error("Failed to cancel subscription:",t),t}}}}export{y as a,w as u};
