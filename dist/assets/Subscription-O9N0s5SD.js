import{r as x,j as e,m as c,q as U,Q as P,L as k,W as C,y as A,C as G,Y as O,_ as V,b as R,$ as B,D as T,V as n}from"./vendor-DneCX9Yi.js";import{lumi as q}from"./lumi-ycYV9txU.js";import{u as F,a as J}from"./useSubscriptions-B_UHsPrg.js";const X=()=>{var S;const{user:s,isAuthenticated:u,signIn:j}=F(),{currentSubscription:r,fetchUserSubscription:g,cancelSubscription:I,createSubscription:_}=J(),[b,f]=x.useState(""),[E,d]=x.useState(!1),[l,y]=x.useState(!1),[w,v]=x.useState(null);x.useEffect(()=>{window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),v(t)})},[]);const D=async()=>{if(w){w.prompt();const{outcome:t}=await w.userChoice;t==="accepted"&&v(null)}else n(`Pour installer l'application : 
Sur iOS : Partager -> Sur l'√©cran d'accueil
Sur Android : Menu -> Installer l'application`,{duration:5e3,icon:"üì±"})};x.useEffect(()=>{const t=new URLSearchParams(window.location.search),i=t.get("select");if(i&&p.find(m=>m.id===i)){f(i),d(!0);const m=window.location.pathname;window.history.replaceState({},document.title,m)}u&&s&&g(s.userId);const a=t.get("success"),o=t.get("plan_id");a==="true"&&o&&s&&!r&&(async()=>{const m=n.loading("Activation de votre abonnement...");try{const h=p.find(M=>M.id===o);h&&(await _({userId:s.userId,plan:o,startDate:new Date().toISOString(),endDate:new Date(Date.now()+2592e6).toISOString(),amount:h.price,status:"active"}),n.success("Abonnement activ√© avec succ√®s !",{id:m}),g(s.userId),window.history.replaceState({},document.title,window.location.pathname))}catch(h){console.error(h),n.error("Erreur lors de l'activation",{id:m})}})()},[u,s]);const p=[{id:"premium_app_monthly",name:"Premium Mensuel",price:6.99,duration:"/mois",features:["Essai 7 jours gratuit","Acc√®s tout exercices","Vid√©os d√©mo","Programmes","Sans engagement"],popular:!0},{id:"premium_app_yearly",name:"Premium Annuel",price:49,duration:"/an",features:["Essai 7 jours gratuit","√âconomisez 40%","Acc√®s tout exercices","Vid√©os d√©mo","Programmes"],popular:!0}],z=async t=>{if(!u){try{await j(),f(t),y(!1),d(!0)}catch{console.log("Authentification annul√©e par l'utilisateur")}return}f(t),y(!1),d(!0)},N=async t=>{if(!l){n.error("Veuillez accepter les conditions g√©n√©rales et l'avertissement sant√© pour continuer");return}if(t==="stripe"){let a="";if(b==="premium_app_monthly"?a="https://buy.stripe.com/9B6eVddg6aHe9WS0DGbwk00":b==="premium_app_yearly"&&(a="https://buy.stripe.com/aFa8wP0tk5mU5GCbikbwk01"),a){const o=new URL(a);s&&(o.searchParams.append("client_reference_id",s.userId),s.email&&o.searchParams.append("prefilled_email",s.email)),window.open(o.toString(),"_blank"),n.success("Page de paiement ouverte dans un nouvel onglet !"),d(!1);return}}d(!1);const i=n.loading("Redirection vers le paiement s√©curis√©...");try{const{url:a}=await q.functions.invoke("createCheckoutSession",{method:"POST",body:{planId:b,userId:s==null?void 0:s.userId,returnUrl:window.location.origin+"/abonnement",provider:t}});a?window.location.href=a:n.error("Erreur lors de l'initialisation",{id:i})}catch(a){console.error(a),n.error(`Erreur: ${a.message||"√âchec de connexion au service de paiement"}`,{id:i})}},$=async()=>{if(!r)return;if(window.confirm("√ätes-vous s√ªr de vouloir annuler votre abonnement ?"))try{await I(r._id),n.success("Abonnement annul√© avec succ√®s"),s&&g(s.userId)}catch{n.error("Erreur lors de l'annulation")}};return u?e.jsxs("div",{className:"min-h-screen bg-gray-900 py-12 relative",children:[E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/80 backdrop-blur-sm",children:e.jsxs(c.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full bg-gray-800 rounded-lg p-8 shadow-2xl border border-gray-700 relative",children:[e.jsx("button",{onClick:()=>d(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-white",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-2xl font-bold text-white text-center mb-6",children:"Choisissez votre mode de paiement"}),e.jsx("div",{className:"mb-6 bg-gray-700/30 p-4 rounded-lg border border-gray-600/50",children:e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:t=>y(t.target.checked),className:"mt-1 w-5 h-5 text-red-600 rounded border-gray-600 bg-gray-700 focus:ring-red-500 flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-gray-300",children:["Je reconnais avoir lu et accept√© les ",e.jsx(k,{to:"/mentions-legales",target:"_blank",className:"text-red-500 hover:underline font-medium",children:"CGV"})," et ",e.jsx(k,{to:"/mentions-legales",target:"_blank",className:"text-red-500 hover:underline font-medium",children:"l'avertissement sant√©"}),". Je certifie √™tre apte √† la pratique sportive."]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>N("stripe"),disabled:!l,className:`w-full py-4 rounded-lg font-bold flex items-center justify-center gap-3 transition-all ${l?"bg-white text-gray-900 hover:bg-gray-100 cursor-pointer":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[e.jsx(C,{className:`w-6 h-6 ${l?"text-blue-600":"text-gray-400"}`}),"Payer par Carte Bancaire"]}),e.jsxs("button",{onClick:()=>N("paypal"),disabled:!l,className:`w-full py-4 rounded-lg font-bold flex items-center justify-center gap-3 transition-all ${l?"bg-[#0070BA] text-white hover:bg-[#005ea6] cursor-pointer":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[e.jsx("span",{className:`italic font-serif text-2xl font-bold ${!l&&"opacity-50"}`,children:"Pay"}),e.jsx("span",{className:`italic font-serif text-2xl font-bold ${l?"text-blue-200":"text-gray-400 opacity-50"}`,children:"Pal"})]})]}),e.jsx("p",{className:"text-center text-gray-400 text-sm mt-6",children:"Paiement 100% s√©curis√©. Acc√®s imm√©diat apr√®s validation."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs(c.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:"text-center mb-12",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:["Mes ",e.jsx("span",{className:"text-green-500",children:"Abonnements"})]}),e.jsx("p",{className:"text-xl text-gray-300",children:"G√©rez vos abonnements  MyGorx Fitness"})]}),r&&e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-800 rounded-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Abonnement Actuel"}),e.jsxs("span",{className:`px-4 py-2 rounded-full text-sm font-semibold ${r.status==="active"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:[r.status==="active"?e.jsx(A,{className:"w-5 h-5 inline mr-1"}):e.jsx(P,{className:"w-5 h-5 inline mr-1"}),r.status==="active"?"Actif":"Inactif"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-red-500 mb-2",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Plan"})]}),e.jsx("p",{className:"text-white text-lg",children:((S=p.find(t=>t.id===r.plan))==null?void 0:S.name)||"N/A"})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-green-500 mb-2",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Date de fin"})]}),e.jsx("p",{className:"text-white text-lg",children:new Date(r.endDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-blue-500 mb-2",children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Montant"})]}),e.jsxs("p",{className:"text-white text-lg",children:[r.amount,"‚Ç¨ / mois"]})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between bg-gray-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-yellow-500",children:[e.jsx(V,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Mot de passe d'acc√®s"})]}),e.jsx("p",{className:"text-white text-lg font-mono bg-gray-800 px-4 py-2 rounded",children:r.accessPassword})]}),r.status==="active"&&e.jsx("button",{onClick:$,className:"mt-6 w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition-colors",children:"Annuler l'abonnement"})]}),e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-white text-center mb-8",children:r?"Changer de Plan":"Choisir un Plan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:p.map((t,i)=>e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1},className:`relative bg-gray-800 rounded-xl overflow-hidden border-2 ${t.popular?"border-red-500 transform md:scale-105 z-10":"border-gray-700"} flex flex-col`,children:[t.popular&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg",children:"POPULAIRE"}),e.jsxs("div",{className:"p-6 flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:t.name}),e.jsxs("div",{className:"flex items-end mb-6",children:[e.jsxs("span",{className:"text-3xl font-bold text-white",children:[t.price,"‚Ç¨"]}),e.jsx("span",{className:"text-gray-400 ml-1 mb-1",children:t.duration})]}),e.jsx("ul",{className:"space-y-3 mb-6",children:t.features.map((a,o)=>e.jsxs("li",{className:"flex items-start text-gray-300 text-sm",children:[e.jsx(A,{className:"w-5 h-5 text-green-500 mr-2 flex-shrink-0"}),e.jsx("span",{children:a})]},o))})]}),e.jsx("div",{className:"p-6 bg-gray-700/50 mt-auto",children:e.jsx("button",{onClick:()=>z(t.id),className:`w-full py-3 rounded-lg font-bold transition-all ${t.popular?"bg-gradient-to-r from-red-600 to-green-600 text-white hover:from-red-700 hover:to-green-700 shadow-lg hover:shadow-red-500/25":"bg-gray-700 text-white hover:bg-gray-600 border border-gray-600"}`,children:t.id.includes("premium")?"Essai Gratuit 7 jours":"Choisir ce plan"})})]},t.id))})]}),e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-red-600 to-green-600 rounded-lg p-8 text-center mb-12",children:[e.jsx(R,{className:"w-12 h-12 text-white mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-3",children:"Paiement S√©curis√©"}),e.jsx("p",{className:"text-white mb-4",children:"Apr√®s votre paiement, vous recevrez automatiquement par email le mot de passe pour acc√©der aux contenus exclusifs (Exercices, Programmes, Nutrition)."}),e.jsx("p",{className:"text-white text-sm opacity-90",children:"Paiement s√©curis√© via Stripe et PayPal ‚Ä¢ Annulation possible √† tout moment"})]}),e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-800 rounded-lg p-8 text-center border border-gray-700",children:[e.jsx(B,{className:"w-12 h-12 text-blue-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-3",children:"Installez l'Application"}),e.jsx("p",{className:"text-gray-300 mb-6 max-w-2xl mx-auto",children:"Pour une meilleure exp√©rience, installez Body Titan directement sur votre t√©l√©phone. Acc√©dez √† vos programmes plus rapidement."}),e.jsxs("button",{onClick:D,className:"inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors shadow-lg hover:shadow-blue-500/25",children:[e.jsx(T,{className:"w-5 h-5 mr-2"}),"Installer l'Application"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"Compatible iOS et Android ‚Ä¢ Sans passage par les stores"})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:e.jsxs(c.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full bg-gray-800 rounded-lg p-8 text-center",children:[e.jsx(U,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-3xl font-bold text-white mb-4",children:["G√©rez vos ",e.jsx("span",{className:"text-green-500",children:"Abonnements"})]}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Connectez-vous pour acc√©der √† vos abonnements et g√©rer vos paiements"}),e.jsx("button",{onClick:j,className:"w-full bg-gradient-to-r from-red-600 to-green-600 text-white py-3 rounded-lg font-semibold hover:from-red-700 hover:to-green-700 transition-colors",children:"Se connecter"})]})})};export{X as default};
